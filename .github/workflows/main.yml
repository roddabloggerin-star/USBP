# .github/workflows/main.yml

name: ðŸŒ¦ï¸ Weather Blog Bot Runner
on:
  schedule:
    - cron: '0 0 * * *' 
  workflow_dispatch:

jobs:
  run_weather_bot:
    runs-on: ubuntu-latest
    
    # 1. Update the env block to include GEMINI_API_KEY
    env:
      NWS_USER_AGENT: ${{ secrets.NWS_USER_AGENT }}
      BLOG_ID: ${{ secrets.BLOG_ID }}
      # NEW: Required for the content generator
      GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }} 
      # The script looks for client_secrets.json at the root
      CLIENT_SECRETS_FILE: client_secrets.json 

    steps:
    - name: â¬‡ï¸ Checkout Repository
      uses: actions/checkout@v4

    # ... (Setup Python and Install Dependencies steps follow here) ...

    # 2. NEW STEP: Create the OAuth files from the secrets
    - name: ðŸ“ Create OAuth Token and Secrets Files
      run: |
        echo "Creating OAuth files from secrets..."
        
        # Create client_secrets.json (used by the script)
        echo '${{ secrets.BLOGGER_CLIENT_SECRETS_JSON }}' > client_secrets.json
        
        # Create token.json (contains the refresh token)
        echo '${{ secrets.BLOGGER_TOKEN_JSON }}' > token.json
        
        echo "OAuth files created successfully."

    # 3. Ensure your main script run command is still correct
    - name: ðŸš€ Run Main Blog Bot Script
      run: |
        python -m src.main